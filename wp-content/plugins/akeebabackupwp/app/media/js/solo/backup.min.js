/*
 Copyright (c)2014-2020 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license   GNU General Public License version 3, or later
*/
if("undefined"===typeof akeeba)var akeeba={};"undefined"===typeof akeeba.Backup&&(akeeba.Backup={URLs:{},tag:"",backupid:null,currentDomain:null,domains:{},srpInfo:{},returnUrl:"",returnForm:"",timeoutTimer:null,resumeTimer:null,resume:{retry:0,showWarnings:0}});akeeba.Backup.timer=function(a){0>=a&&(a=10);setTimeout(akeeba.Backup.timerTick,a)};
akeeba.Backup.timerTick=function(){try{console.log("Timer tick")}catch(a){}var d=akeeba.System.getOptions("akeeba.Backup.maxExecutionTime",14),b=akeeba.System.getOptions("akeeba.Backup.runtimeBias",75);akeeba.Backup.resetTimeoutBar();akeeba.Backup.startTimeoutBar(d,b);akeeba.System.doAjax({ajax:"step",tag:akeeba.Backup.tag,backupid:akeeba.Backup.backupid},akeeba.Backup.onStep,akeeba.Backup.onError,!1)};
akeeba.Backup.startTimeoutBar=function(a,d){var b=0;akeeba.Backup.timeoutTimer=setInterval(function(){b++;var a=document.querySelector("#response-timer div.text");a&&(a.textContent=akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s",b.toFixed(0)))},1E3)};
akeeba.Backup.resetTimeoutBar=function(){Piecon.setOptions({color:"#333333",background:"#e0e0e0",shadow:"#000000",fallback:"force"});try{clearInterval(akeeba.Backup.timeoutTimer)}catch(a){}var d=document.querySelector("#response-timer div.text");d&&(d.textContent=akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s","0"))};
akeeba.Backup.startRetryTimeoutBar=function(){var a=akeeba.System.getOptions("akeeba.Backup.resume.timeout",10);akeeba.Backup.resumeTimer=setInterval(function(){a--;document.getElementById("akeeba-retry-timeout").textContent=a.toFixed(0);0==a&&(clearInterval(akeeba.Backup.resumeTimer),akeeba.Backup.resumeBackup())},1E3)};
akeeba.Backup.resetRetryTimeoutBar=function(){clearInterval(akeeba.Backup.resumeTimer);var a=akeeba.System.getOptions("akeeba.Backup.resume.timeout",10);document.getElementById("akeeba-retry-timeout").textContent=a.toFixed(0)};
akeeba.Backup.renderBackupSteps=function(a){var d="akeeba-label--green";""==a&&(d="akeeba-label--grey");document.getElementById("backup-steps").innerHTML="";for(var b=akeeba.System.getOptions("akeeba.Backup.domains",{}),c=0;c<b.length;c++){var f=b[c],e=document.createElement("div");e.className=" ";e.innerHTML=f[1];akeeba.System.data.set("domain",f[0]);document.getElementById("backup-steps").appendChild(e);f[0]==a?(d="akeeba-label--grey",f="akeeba-label--teal"):f=d;e.className+=" "+f}};
akeeba.Backup.start=function(){try{console.log("Starting backup"),console.log(data)}catch(a){}if(window.AVGRUN){try{console.warn("AVG Antivirus with Link Checker detected. The backup WILL fail!")}catch(d){}if(!confirm(akeeba.System.Text._("SOLO_BACKUP_AVGWARNING")))return}try{null!=akeeba.Backup.commentEditorSave&&akeeba.Backup.commentEditorSave()}catch(b){document.getElementById("comment").value=""}var c="";try{c=document.getElementById("jpskey").value}catch(f){c=""}var e="";try{e=document.getElementById("angiekey").value}catch(h){e=
""}document.getElementById("backup-setup").style.display="none";document.getElementById("backup-progress-pane").style.display="block";var g=akeeba.System.getOptions("akeeba.Backup.config_angiekey");e&&""===g&&(document.getElementById("angie-password-warning").style.display="block");g=new Date;akeeba.System.notification.notify(akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_BACKUPSTARTED")+" "+g.toLocaleString());akeeba.Backup.renderBackupSteps("");var g=akeeba.System.getOptions("akeeba.Backup.maxExecutionTime",
14),k=akeeba.System.getOptions("akeeba.Backup.runtimeBias",75);akeeba.Backup.startTimeoutBar(g,k);akeeba.Backup.tag=akeeba.Backup.srpInfo.tag;c={ajax:"start",description:document.getElementById("backup-description").value,comment:document.getElementById("comment").value,jpskey:c,angiekey:e};c=array_merge(c,akeeba.Backup.srpInfo);akeeba.System.doAjax(c,akeeba.Backup.onStep,akeeba.Backup.onError,!1)};
akeeba.Backup.onStep=function(a){try{console.log("Running backup step"),console.log(a)}catch(d){}akeeba.Backup.renderBackupSteps(a.Domain);akeeba.Backup.currentDomain=a.Domain;document.querySelector("#backup-percentage div.bar").style.width=a.Progress+"%";100<=a.Progress?Piecon.setProgress(99):Piecon.setProgress(a.Progress);document.getElementById("backup-step").textContent=a.Step;document.getElementById("backup-substep").textContent=a.Substep;a.Warnings=a.Warnings||[];if(0<a.Warnings.length){-1==
document.getElementById("backup-percentage").className.indexOf("akeeba-progress--warning")&&(document.getElementById("backup-percentage").className="akeeba-progress--warning");for(var b=0;b<a.Warnings.length;b++){var c=a.Warnings[b];akeeba.System.notification.notify(akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_BACKUPWARNING"),c);var f=document.createElement("div");f.textContent=c;document.getElementById("warnings-list").appendChild(f)}document.getElementById("backup-warnings-panel").style.display=
"block"}b=a.Error;if(""!=b){try{console.error("Got an error message"),console.log(b)}catch(e){}akeeba.Backup.onError(b)}else if(1==a.HasRun){try{console.log("Backup complete"),console.log(b)}catch(h){}akeeba.Backup.onDone()}else{empty(akeeba.Backup.tag)&&(akeeba.Backup.tag="backend");akeeba.Backup.backupid=a.backupid;akeeba.Backup.resume.retry=0;b=10;a.hasOwnProperty("sleepTime")&&(b=a.sleepTime);try{console.log("Starting tick timer with waitTime = "+b+" msec")}catch(g){}akeeba.Backup.timer(b)}};
akeeba.Backup.resumeBackup=function(){akeeba.Backup.resetRetryTimeoutBar();document.getElementById("error-panel").style.display="none";document.getElementById("retry-panel").style.display="none";document.getElementById("backup-progress-pane").style.display="block";akeeba.Backup.resume.showWarnings&&(document.getElementById("backup-warnings-panel").style.display="block");var a=new Date;akeeba.System.notification.notify(akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_BACKUPRESUME")+" "+a.toLocaleString());
akeeba.Backup.timer()};akeeba.Backup.cancelResume=function(){akeeba.Backup.resetRetryTimeoutBar();var a=document.getElementById("backup-error-message-retry").innerHTML;akeeba.Backup.endWithError(a)};
akeeba.Backup.onError=function(a){if(akeeba.System.getOptions("akeeba.Backup.resume.enabled",!0)){var d=akeeba.System.getOptions("akeeba.Backup.resume.maxRetries");if(akeeba.Backup.resume.retry>=d)akeeba.Backup.endWithError(a);else{akeeba.Backup.resume.retry++;akeeba.Backup.resetRetryTimeoutBar();var d=akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_BACKUPHALT_DESC"),b=akeeba.System.getOptions("akeeba.Backup.resume.timeout",10),d=d.replace("%d",b.toFixed(0));akeeba.System.notification.notify(akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_BACKUPHALT"),
d);akeeba.Backup.resume.showWarnings="none"!==document.getElementById("backup-warnings-panel").style.display;document.getElementById("backup-progress-pane").style.display="none";document.getElementById("backup-warnings-panel").style.display="none";document.getElementById("error-panel").style.display="none";document.getElementById("backup-error-message-retry").textContent=a;document.getElementById("retry-panel").style.display="block";akeeba.Backup.startRetryTimeoutBar()}}else akeeba.Backup.endWithError(a)};
akeeba.Backup.endWithError=function(a){akeeba.Backup.resetTimeoutBar();try{Piecon.reset()}catch(d){}var b=!1;document.getElementById("backup-progress-pane").style.display="none";document.getElementById("backup-warnings-panel").style.display="none";document.getElementById("retry-panel").style.display="none";var c=akeeba.System.getOptions("akeeba.Backup.URLs.LogURL"),f=akeeba.System.getOptions("akeeba.Backup.URLs.AliceURL"),c=c+"&tag="+akeeba.Backup.tag,e=f+"&log="+akeeba.Backup.tag;akeeba.Backup.backupid&&
(c=c+"."+encodeURIComponent(akeeba.Backup.backupid),e=e+"."+encodeURIComponent(akeeba.Backup.backupid));"finale"==akeeba.Backup.currentDomain&&(b=!0,e+="&autorun=1");document.getElementById("ab-viewlog-error").setAttribute("href",c);document.getElementById("ab-alice-error").setAttribute("href",e);akeeba.System.notification.notify(akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_BACKUPFAILED"),a);akeeba.System.doAjax({ajax:"pushFail",tag:akeeba.Backup.tag,backupid:akeeba.Backup.backupid,errorMessage:a},
function(a){});document.getElementById("backup-error-message").textContent=a;document.getElementById("error-panel").style.display="block";b&&setTimeout(function(){window.location=e},500)};
akeeba.Backup.onDone=function(){var a=new Date;akeeba.System.notification.notify(akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_BACKUPFINISHED")+" "+a.toLocaleString());akeeba.Backup.resetTimeoutBar();try{Piecon.reset()}catch(d){}document.getElementById("backup-progress-pane").style.display="none";document.getElementById("backup-complete").style.display="block";document.getElementById("backup-warnings-panel").style.width="100%";var a=akeeba.System.getOptions("akeeba.Backup.URLs.LogURL"),b=a+"&tag="+
akeeba.Backup.tag;akeeba.Backup.tag?akeeba.Backup.backupid&&(b=b+"."+encodeURIComponent(akeeba.Backup.backupid)):b=a+"&latest=1";try{document.getElementById("ab-viewlog-success").setAttribute("href",b)}catch(c){}akeeba.System.getOptions("akeeba.Backup.returnForm",!1)?document.getElementById("returnForm").submit():(a=akeeba.System.getOptions("akeeba.Backup.returnUrl",""),""!==a&&(window.location=a))};
akeeba.Backup.restoreDefaultOptions=function(){document.getElementById("backup-description").value=akeeba.System.getOptions("akeeba.Backup.defaultDescription");var a=document.getElementById("angiekey");a&&(a.value="ThisIsADummyStringToWorkAroundChrome",a.value=akeeba.System.getOptions("akeeba.Backup.config_angiekey"));if(a=document.getElementById("jpskey"))a.value="ThisIsADummyStringToWorkAroundChrome",a.value=akeeba.System.getOptions("akeeba.Backup.jpsKey");document.getElementById("comment").value=
"ThisIsADummyStringToWorkAroundChrome";document.getElementById("comment").value=""};
akeeba.Backup.restoreCurrentOptions=function(){var a=document.getElementById("backup-description"),d=document.getElementById("angiekey"),b=document.getElementById("jpskey"),c=document.getElementById("comment");null!==a&&(a.value=akeeba.System.getOptions("akeeba.Backup.currentDescription"));null!==d&&(d.value="ThisIsADummyStringToWorkAroundChrome",d.value=akeeba.System.getOptions("akeeba.Backup.config_angiekey"));null!==b&&(b.value="ThisIsADummyStringToWorkAroundChrome",b.value=akeeba.System.getOptions("akeeba.Backup.jpsKey"));
null!==c&&(c.value="ThisIsADummyStringToWorkAroundChrome",c.value=akeeba.System.getOptions("akeeba.Backup.currentComment"))};akeeba.Backup.flipProfile=function(){document.getElementById("flipDescription").value=document.getElementById("backup-description").value;document.getElementById("flipComment").value=document.getElementById("comment").value;document.forms.profileForm.submit()};
akeeba.System.documentReady(function(){akeeba.System.addEventListener("backup-start","click",function(a){a.preventDefault();akeeba.Backup.start();return!1});akeeba.System.addEventListener("backup-default","click",function(a){a.preventDefault();akeeba.Backup.restoreDefaultOptions();return!1});akeeba.System.addEventListener("comAkeebaBackupFlipProfile","click",function(a){a.preventDefault();akeeba.Backup.flipProfile();return!1});akeeba.System.addEventListener("comAkeebaBackupResumeCancel","click",function(a){a.preventDefault();
akeeba.Backup.cancelResume();return!1});akeeba.System.addEventListener("comAkeebaBackupResume","click",function(a){a.preventDefault();akeeba.Backup.resumeBackup();return!1});akeeba.System.addEventListener("profileId","change",akeeba.Backup.flipProfile);setTimeout(function(){akeeba.Backup.restoreCurrentOptions();akeeba.System.getOptions("akeeba.Backup.autoStart",!1)&&akeeba.Backup.start()},500);akeeba.System.notification.askPermission()}); //# sourceMappingURL=backup.min.map
