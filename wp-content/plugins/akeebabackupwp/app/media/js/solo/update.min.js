/*
 Copyright (c)2014-2020 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license   GNU General Public License version 3, or later
*/
if("undefined"===typeof akeeba)var akeeba={};"undefined"===typeof akeeba.Update&&(akeeba.Update={errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null,password:null,ajaxURL:null,mainURL:null,translations:{},nextStepUrl:"",finaliseUrl:""});
akeeba.Update.downloadErrorCallback=function(a){var b=document.getElementById("downloadProgressInfo"),c=document.getElementById("downloadProgressBar");b.style.display="none";c.className="akeeba-progress-fill--failure";document.getElementById("downloadErrorText").innerHTML=a;document.getElementById("downloadError").style.display="block"};
akeeba.Update.extractErrorCallback=function(a){var b=document.getElementById("extractProgressInfo"),c=document.getElementById("extractProgressBar");b.style.display="none";c.className="akeeba-progress-fill--failure";document.getElementById("extractErrorText").innerHTML=a;document.getElementById("extractError").style.display="block"};akeeba.Update.nextStep=function(){window.location=akeeba.System.getOptions("akeeba.Update.nextStepUrl")};akeeba.Update.onGenericError=function(a){alert(a)};
akeeba.Update.setProgressBar=function(a,b){void 0===b&&(b="downloadProgressBar");var c;c=1>=a?100*a:a;0>c&&(c=0);100<c&&(c=100);var d=document.getElementById(b),e=document.getElementById(b+"Info");d.className=100>c?"akeeba-progress-fill":"akeeba-progress-fill--success";document.getElementById(b).style.width=c.toFixed(1)+"%";e.innerText=c.toFixed(1)+"%";Piecon.setProgress(c)};
akeeba.Update.humanFileSize=function(a,b){var c=b?1E3:1024;if(a<c)return a+" B";var d=b?"kB MB GB TB PB EB ZB YB".split(" "):"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),e=-1;do a/=c,++e;while(a>=c);return a.toFixed(1)+" "+d[e]};
akeeba.Update.startDownload=function(){akeeba.Update.setProgressBar(0,"downloadProgressBar");Piecon.setOptions({color:"#333333",background:"#e0e0e0",shadow:"#000000",fallback:"force"});document.getElementById("downloadProgressBarText").innerHTML="";var a={task:"downloader",json:JSON.stringify({frag:-1,totalSize:-1})};akeeba.System.doAjax(a,function(a){akeeba.Update.stepDownload(a)},null,!1)};
akeeba.Update.stepDownload=function(a){if(a.status){var b=0,c=0,d=0,e=-1;void 0!==a.totalSize&&(b=a.totalSize);void 0!==a.doneSize&&(c=a.doneSize);void 0!==a.percent&&(d=a.percent);void 0!==a.frag&&(e=a.frag);akeeba.Update.setProgressBar(d,"downloadProgressBar");document.getElementById("downloadProgressBarText").innerText=d.toFixed(1)+"%";a={task:"downloader",json:JSON.stringify({frag:e,totalSize:b,doneSize:c})};if(100>d)akeeba.System.doAjax(a,function(a){akeeba.Update.stepDownload(a)},null,!1);else{akeeba.Update.setProgressBar(100,
"downloadProgressBar");try{Piecon.reset()}catch(f){}akeeba.Update.nextStep()}}else 300<=a.errorCode&&500>a.errorCode?akeeba.Update.downloadErrorCallback(akeeba.System.Text._("SOLO_UPDATE_ERR_INVALIDDOWNLOADID")):akeeba.Update.downloadErrorCallback(a.error)};
akeeba.Update.pingExtract=function(){akeeba.Update.statistics.files=0;akeeba.Update.statistics.inbytes=0;akeeba.Update.statistics.outbytes=0;akeeba.System.doEncryptedAjax({task:"ping"},function(a){akeeba.Update.startExtract(a)},function(a){document.getElementById("extractProgress").style.display="none";document.getElementById("extractPingError").style.display="block"})};
akeeba.Update.startExtract=function(){akeeba.Update.statistics.files=0;akeeba.Update.statistics.inbytes=0;akeeba.Update.statistics.outbytes=0;akeeba.System.doEncryptedAjax({task:"startRestore"},function(a){akeeba.Update.stepExtract(a)})};
akeeba.Update.stepExtract=function(a){if(!1==a.status)akeeba.System.errorCallback(a.message);else{if(void 0!==a.totalsize){if(is_array(a.filelist))for(var b=akeeba.Update.statistics.totalSize=0;b<a.filelist.length;b++)akeeba.Update.statistics.totalSize+=a.filelist[b][1];akeeba.Update.statistics.files=0;akeeba.Update.statistics.inbytes=0;akeeba.Update.statistics.outbytes=0}akeeba.Update.statistics.files+=a.files;akeeba.Update.statistics.inbytes+=a.bytesIn;akeeba.Update.statistics.outbytes+=a.bytesOut;
b=0;0<akeeba.Update.statistics.totalSize&&(b=100*akeeba.Update.statistics.inbytes/akeeba.Update.statistics.totalSize,0>b?b=0:100<b&&(b=100));a.done&&(b=100);akeeba.Update.setProgressBar(b,"extractProgressBar");document.getElementById("extractProgressBarTextPercent").innerText=b.toFixed(1);document.getElementById("extractProgressBarTextIn").innerText=akeeba.Update.humanFileSize(akeeba.Update.statistics.inbytes,0)+" / "+akeeba.Update.humanFileSize(akeeba.Update.statistics.totalSize,0);document.getElementById("extractProgressBarTextOut").innerText=
akeeba.Update.humanFileSize(akeeba.Update.outbytes,0);document.getElementById("extractProgressBarTextFile").innerText=a.lastfile;empty(a.factory)||(akeeba.Update.factory=a.factory);a.done?window.setTimeout(akeeba.Update.finalizeUpdate,500):(post={task:"stepRestore",factory:a.factory},akeeba.System.doEncryptedAjax(post,function(a){akeeba.Update.stepExtract(a)}))}};
akeeba.Update.finalizeUpdate=function(){akeeba.System.doEncryptedAjax({task:"finalizeRestore",factory:akeeba.Update.factory},function(a){window.location=akeeba.System.getOptions("akeeba.Update.finaliseUrl")})};
akeeba.System.documentReady(function(){akeeba.System.addEventListener("btnLiveUpdateReleaseNotes","click",function(){akeeba.Modal.open({inherit:"#releaseNotesPopup",width:"80%"});return!1});akeeba.System.params.errorCallback=akeeba.Update.downloadErrorCallback;switch(akeeba.System.getOptions("akeeba.Update.autoAction","none")){case "startDownload":akeeba.Update.startDownload();break;case "pingExtract":akeeba.Update.pingExtract()}}); //#sourceMappingURL=update.min.map
